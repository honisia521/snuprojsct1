import streamlit as st
import pandas as pd

# --- ìƒ˜í”Œ ê²Œì„ ë°ì´í„° ---
games = {
    "ë¦¬ê·¸ ì˜¤ë¸Œ ë ˆì „ë“œ": {"ì¥ë¥´": "AOS", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.5, "ì„¤ëª…": "5ëŒ€5 íŒ€ ì „ëµ ê²Œì„. ë‹¤ì–‘í•œ ì±”í”¼ì–¸ê³¼ ì „ëµìœ¼ë¡œ ìŠ¹ë¦¬í•˜ì„¸ìš”."},
    "ë°°í‹€ê·¸ë¼ìš´ë“œ": {"ì¥ë¥´": "FPS", "ë‚œì´ë„": "ìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.0, "ì„¤ëª…": "ìµœí›„ì˜ 1ì¸ì´ ë  ë•Œê¹Œì§€ ì‹¸ìš°ëŠ” ë°°í‹€ë¡œì–„ ê²Œì„."},
    "ë§ˆì¸í¬ë˜í”„íŠ¸": {"ì¥ë¥´": "ìƒŒë“œë°•ìŠ¤", "ë‚œì´ë„": "í•˜", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.8, "ì„¤ëª…": "ë¸”ë¡ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì„¸ìƒì—ì„œ ììœ ë¡­ê²Œ íƒí—˜í•˜ê³  ê±´ì¶•í•˜ì„¸ìš”."},
    "ìŠ¤íƒ€í¬ë˜í”„íŠ¸ ë¦¬ë§ˆìŠ¤í„°": {"ì¥ë¥´": "RTS", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.2, "ì„¤ëª…": "ì „ì„¤ì ì¸ ì‹¤ì‹œê°„ ì „ëµ ê²Œì„. 3ê°€ì§€ ì¢…ì¡±ìœ¼ë¡œ ìš°ì£¼ë¥¼ ì§€ë°°í•˜ì„¸ìš”."},
    "ì–´ëª½ ì–´ìŠ¤": {"ì¥ë¥´": "ì¶”ë¦¬", "ë‚œì´ë„": "í•˜", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 3.9, "ì„¤ëª…": "ìš°ì£¼ì„  ì•ˆì˜ ì„í¬ìŠ¤í„°ë¥¼ ì°¾ì•„ë‚´ëŠ” ë§ˆí”¼ì•„ ê²Œì„."},
    "ì—˜ë“  ë§": {"ì¥ë¥´": "ì•¡ì…˜ RPG", "ë‚œì´ë„": "ìµœìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.7, "ì„¤ëª…": "ê´‘í™œí•œ íŒíƒ€ì§€ ì„¸ê³„ì—ì„œ ê³ ë‚œì´ë„ì˜ ì•¡ì…˜ RPGë¥¼ ê²½í—˜í•˜ì„¸ìš”."},
    "ë¡œìŠ¤íŠ¸ì•„í¬": {"ì¥ë¥´": "MMORPG", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.4, "ì„¤ëª…": "ë°©ëŒ€í•œ ì„¸ê³„ê´€ê³¼ í™”ë ¤í•œ ì•¡ì…˜ì˜ MMORPG."},
    "ë°œë¡œë€íŠ¸": {"ì¥ë¥´": "FPS", "ë‚œì´ë„": "ìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.2, "ì„¤ëª…": "ì •êµí•œ ì´ê²©ì „ê³¼ ìš”ì› ìŠ¤í‚¬ì„ í™œìš©í•˜ëŠ” ì „ëµ FPS."},
    "ë””ì•„ë¸”ë¡œ 4": {"ì¥ë¥´": "ì•¡ì…˜ RPG", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.0, "ì„¤ëª…": "ì–´ë‘ìš´ íŒíƒ€ì§€ ì„¸ê³„ì—ì„œ ì•…ë§ˆë¥¼ ì‚¬ëƒ¥í•˜ëŠ” í•µì•¤ìŠ¬ë˜ì‹œ RPG."}
}

df_games = pd.DataFrame.from_dict(games, orient='index')
df_games.index.name = 'ê²Œì„ ì´ë¦„'

st.set_page_config(layout="wide", page_title="ë¬´ë£Œ ê²Œì„ ì¶”ì²œ")

st.title("ğŸ® AI ì—†ì´ë„ ë™ì‘í•˜ëŠ” ê²Œì„ ì¶”ì²œ (ë¬´ë£Œ)")
st.write("ì¢‹ì•„í•˜ëŠ” ê²Œì„ì´ë‚˜ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ë©´ ìœ ì‚¬í•œ ê²Œì„ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤!")

# --- ì¶”ì²œ ë°©ì‹ ---
recommendation_type = st.radio("ì¶”ì²œ ë°©ì‹ ì„ íƒ:", ("ì„ í˜¸ ê²Œì„ ì„ íƒ", "ììœ ë¡œìš´ í…ìŠ¤íŠ¸ ì„¤ëª…"), index=0)

def recommend_by_game(selected_game, n=3):
    # ê°™ì€ ì¥ë¥´ ê²Œì„ ì¤‘ ì¶”ì²œ (ë³¸ì¸ ê²Œì„ ì œì™¸)
    genre = df_games.loc[selected_game, "ì¥ë¥´"]
    similar = df_games[df_games["ì¥ë¥´"] == genre].drop(selected_game, errors='ignore')
    return similar.head(n)

def recommend_by_text(user_text, n=3):
    # ê°„ë‹¨ í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ ì¶”ì²œ
    keywords = user_text.lower().split()
    scores = {}
    for game, info in games.items():
        text = f"{game} {info['ì¥ë¥´']} {info['ì„¤ëª…']}".lower()
        score = sum(text.count(k) for k in keywords)
        if score > 0:
            scores[game] = score
    sorted_games = sorted(scores.items(), key=lambda x: x[1], reverse=True)
    recommended = [df_games.loc[g] for g, s in sorted_games[:n]]
    return pd.DataFrame(recommended)

# --- ì²˜ë¦¬ ---
if recommendation_type == "ì„ í˜¸ ê²Œì„ ì„ íƒ":
    selected_game = st.selectbox("ì¢‹ì•„í•˜ëŠ” ê²Œì„ ì„ íƒ:", ['--ì„ íƒ--', *sorted(df_games.index.tolist())])
    if selected_game != '--ì„ íƒ--' and st.button("ì¶”ì²œë°›ê¸°"):
        result = recommend_by_game(selected_game)
        st.subheader(f"ğŸ’¡ '{selected_game}'ì™€ ë¹„ìŠ·í•œ ê²Œì„ ì¶”ì²œ")
        st.table(result)

elif recommendation_type == "ììœ ë¡œìš´ í…ìŠ¤íŠ¸ ì„¤ëª…":
    user_desc = st.text_area("ì›í•˜ëŠ” ê²Œì„ ìŠ¤íƒ€ì¼ì„ ì…ë ¥:", height=100)
    if st.button("ì¶”ì²œë°›ê¸°"):
        if user_desc.strip():
            result = recommend_by_text(user_desc)
            st.subheader(f"ğŸ’¡ '{user_desc}'ì— ë§ëŠ” ê²Œì„ ì¶”ì²œ")
            st.table(result)
        else:
            st.warning("ê²Œì„ ìŠ¤íƒ€ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")
