# /mount/src/snuprojsct1/pages/01_AIì¶”ì²œ.py

# ì´ ì¤„ì´ ì½”ë“œì˜ ë§¨ ìœ„ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
import streamlit as st 

# ì´ì œ ì´ ì¤„ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•  ê²ë‹ˆë‹¤.
GEMINI_API_KEY = st.secrets["GEMINI_API_KEY"]
...

# pages/gemini_recommender.py

import streamlit as st
import pandas as pd # ê²Œì„ ëª©ë¡ í‘œì‹œìš©
import google.generativeai as genai # Gemini API ì‚¬ìš©

# Google AI Studio API Key ì„¤ì •
# ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” st.secrets["GEMINI_API_KEY"] ì™€ ê°™ì´ ì‚¬ìš©í•˜ì„¸ìš”.
# https://aistudio.google.com/app/apikey ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
GEMINI_API_KEY = "YOUR_GEMINI_API_KEY" # <-- ì—¬ê¸°ì— ì‹¤ì œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!

genai.configure(api_key=GEMINI_API_KEY)

# --- ê²Œì„ ë°ì´í„° (ì°¸ê³ ìš©ìœ¼ë¡œ ê°€ì ¸ì˜´, ì‹¤ì œ API í˜¸ì¶œì—ëŠ” ì§ì ‘ ì‚¬ìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ) ---
games = {
    "ë¦¬ê·¸ ì˜¤ë¸Œ ë ˆì „ë“œ": {"ì¥ë¥´": "AOS", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.5, "ì„¤ëª…": "5ëŒ€5 íŒ€ ì „ëµ ê²Œì„. ë‹¤ì–‘í•œ ì±”í”¼ì–¸ê³¼ ì „ëµìœ¼ë¡œ ìŠ¹ë¦¬í•˜ì„¸ìš”."},
    "ë°°í‹€ê·¸ë¼ìš´ë“œ": {"ì¥ë¥´": "FPS", "ë‚œì´ë„": "ìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.0, "ì„¤ëª…": "ìµœí›„ì˜ 1ì¸ì´ ë  ë•Œê¹Œì§€ ì‹¸ìš°ëŠ” ë°°í‹€ë¡œì–„ ê²Œì„."},
    "ë§ˆì¸í¬ë˜í”„íŠ¸": {"ì¥ë¥´": "ìƒŒë“œë°•ìŠ¤", "ë‚œì´ë„": "í•˜", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.8, "ì„¤ëª…": "ë¸”ë¡ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì„¸ìƒì—ì„œ ììœ ë¡­ê²Œ íƒí—˜í•˜ê³  ê±´ì¶•í•˜ì„¸ìš”."},
    "ìŠ¤íƒ€í¬ë˜í”„íŠ¸ ë¦¬ë§ˆìŠ¤í„°": {"ì¥ë¥´": "RTS", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.2, "ì„¤ëª…": "ì „ì„¤ì ì¸ ì‹¤ì‹œê°„ ì „ëµ ê²Œì„. 3ê°€ì§€ ì¢…ì¡±ìœ¼ë¡œ ìš°ì£¼ë¥¼ ì§€ë°°í•˜ì„¸ìš”."},
    "ì–´ëª½ ì–´ìŠ¤": {"ì¥ë¥´": "ì¶”ë¦¬", "ë‚œì´ë„": "í•˜", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 3.9, "ì„¤ëª…": "ìš°ì£¼ì„  ì•ˆì˜ ì„í¬ìŠ¤í„°ë¥¼ ì°¾ì•„ë‚´ëŠ” ë§ˆí”¼ì•„ ê²Œì„."},
    "ì ¤ë‹¤ì˜ ì „ì„¤ ë¸Œë ˆìŠ¤ ì˜¤ë¸Œ ë” ì™€ì¼ë“œ": {"ì¥ë¥´": "ì•¡ì…˜ ì–´ë“œë²¤ì²˜", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€", "í‰ì ": 4.9, "ì„¤ëª…": "ê´‘í™œí•œ í•˜ì´ë„ì„ íƒí—˜í•˜ë©° ë¯¸ìŠ¤í„°ë¦¬ë¥¼ í’€ì–´ê°€ëŠ” ì˜¤í”ˆì›”ë“œ ì–´ë“œë²¤ì²˜."},
    "í´ê°€ì´ì¦ˆ": {"ì¥ë¥´": "íŒŒí‹°", "ë‚œì´ë„": "í•˜", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 3.7, "ì„¤ëª…": "ì—‰ëš±í•œ ì¥ì• ë¬¼ ì½”ìŠ¤ë¥¼ í†µê³¼í•˜ëŠ” ìºì£¼ì–¼ ë°°í‹€ ë¡œì–„."},
    "ì‚¬ì´ë²„í‘í¬ 2077": {"ì¥ë¥´": "RPG", "ë‚œì´ë„": "ìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€", "í‰ì ": 4.1, "ì„¤ëª…": "ë¯¸ë˜ ë„ì‹œ ë‚˜ì´íŠ¸ ì‹œí‹°ì—ì„œ í¼ì³ì§€ëŠ” ê´‘ëŒ€í•œ ì˜¤í”ˆì›”ë“œ RPG."},
    "ì—˜ë“  ë§": {"ì¥ë¥´": "ì•¡ì…˜ RPG", "ë‚œì´ë„": "ìµœìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.7, "ì„¤ëª…": "ê´‘í™œí•œ íŒíƒ€ì§€ ì„¸ê³„ì—ì„œ ê³ ë‚œì´ë„ì˜ ì•¡ì…˜ RPGë¥¼ ê²½í—˜í•˜ì„¸ìš”."},
    "ì˜¤ë²„ì›Œì¹˜ 2": {"ì¥ë¥´": "FPS", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.3, "ì„¤ëª…": "ì˜ì›… ê¸°ë°˜ì˜ íŒ€ ëŒ€ì „ FPS. ë‹¤ì–‘í•œ ì˜ì›…ê³¼ ì „ëµìœ¼ë¡œ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”."},
    "ë¡œìŠ¤íŠ¸ì•„í¬": {"ì¥ë¥´": "MMORPG", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.4, "ì„¤ëª…": "ë°©ëŒ€í•œ ì„¸ê³„ê´€ê³¼ í™”ë ¤í•œ ì•¡ì…˜ì˜ MMORPG.", "íƒœê·¸": "íŒíƒ€ì§€, í•µì•¤ìŠ¬ë˜ì‹œ, MMORPG, ìŠ¤í† ë¦¬, ë ˆì´ë“œ, ì„±ì¥"},
    "ë°œë¡œë€íŠ¸": {"ì¥ë¥´": "FPS", "ë‚œì´ë„": "ìƒ", "í”Œë ˆì´ì–´ ìˆ˜": "ë©€í‹°", "í‰ì ": 4.2, "ì„¤ëª…": "ì •êµí•œ ì´ê²©ì „ê³¼ ìš”ì› ìŠ¤í‚¬ì„ í™œìš©í•˜ëŠ” ì „ëµ FPS.", "íƒœê·¸": "ì „ëµ ìŠˆí„°, FPS, eìŠ¤í¬ì¸ , ë¬´ë£Œ, ë©€í‹°í”Œë ˆì´ì–´"},
    "ë””ì•„ë¸”ë¡œ 4": {"ì¥ë¥´": "ì•¡ì…˜ RPG", "ë‚œì´ë„": "ì¤‘", "í”Œë ˆì´ì–´ ìˆ˜": "ì‹±ê¸€/ë©€í‹°", "í‰ì ": 4.0, "ì„¤ëª…": "ì–´ë‘ìš´ íŒíƒ€ì§€ ì„¸ê³„ì—ì„œ ì•…ë§ˆë¥¼ ì‚¬ëƒ¥í•˜ëŠ” í•µì•¤ìŠ¬ë˜ì‹œ RPG.", "íƒœê·¸": "ë‹¤í¬ íŒíƒ€ì§€, í•µì•¤ìŠ¬ë˜ì‹œ, RPG, íŒŒë°, ì•¡ì…˜, ìŠ¤í† ë¦¬"}
}
df_games = pd.DataFrame.from_dict(games, orient='index')
df_games.index.name = 'ê²Œì„ ì´ë¦„'

# ëª¨ë¸ ì´ˆê¸°í™”
model = genai.GenerativeModel('gemini-pro') # ë˜ëŠ” 'gemini-1.0-pro'

st.set_page_config(layout="wide", page_title="AI ê¸°ë°˜ ì¶”ì²œ")

st.title("âœ¨ AI ê¸°ë°˜ ê²Œì„ ì¶”ì²œ (Powered by Gemini)")
st.markdown("""
    <style>
    .game-card {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
        background-color: #f9f9f9;
    }
    .game-title {
        color: #007BFF; /* AI ì¶”ì²œì„ ìœ„í•œ ë‹¤ë¥¸ ìƒ‰ìƒ */
    }
    </style>
    """, unsafe_allow_html=True)
st.write("ì¢‹ì•„í•˜ëŠ” ê²Œì„ì´ë‚˜ ì›í•˜ëŠ” ê²Œì„ ìŠ¤íƒ€ì¼ì„ ì•Œë ¤ì£¼ì„¸ìš”. Gemini AIê°€ ë‹¹ì‹ ì„ ìœ„í•œ ìƒˆë¡œìš´ ê²Œì„ì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤!")

# --- ì‚¬ìš©ì ì…ë ¥ ë°©ì‹ ì„ íƒ ---
recommendation_type = st.radio(
    "ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¶”ì²œë°›ìœ¼ì‹œê² ì–´ìš”?",
    ("ì„ í˜¸ ê²Œì„ ì„ íƒ", "ììœ ë¡œìš´ í…ìŠ¤íŠ¸ ì„¤ëª…"),
    index=0
)

recommended_games_from_gemini = []

if recommendation_type == "ì„ í˜¸ ê²Œì„ ì„ íƒ":
    selected_game = st.selectbox(
        "ì¢‹ì•„í•˜ëŠ” ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”:",
        ['--ì„ íƒ--', *sorted(df_games.index.tolist())],
        key="gemini_rec_game_select"
    )
    if selected_game != '--ì„ íƒ--':
        st.info(f"'{selected_game}'ì™€(ê³¼) ë¹„ìŠ·í•œ ê²Œì„ì„ ì¶”ì²œí•´ ë“œë¦´ê²Œìš”!")
        prompt_input = f"ë‹¤ìŒ ê²Œì„ê³¼ ë¹„ìŠ·í•œ ê²Œì„ 3ê°œë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”: {selected_game}. ì¶”ì²œ ê²Œì„ì€ ê²Œì„ ì´ë¦„, ì¥ë¥´, 1~2ë¬¸ì¥ì˜ ê°„ëµí•œ ì„¤ëª… í˜•ì‹ìœ¼ë¡œ í•œêµ­ì–´ë¡œ ì œì‹œí•´ ì£¼ì„¸ìš”. ê·¸ë¦¬ê³  ì„¤ëª…ì€ í¥ë¯¸ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."
        if st.button("AI ì¶”ì²œë°›ê¸° (ì„ í˜¸ ê²Œì„)", key="btn_gemini_game_rec"):
            with st.spinner("Gemini AIê°€ ê²Œì„ì„ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤..."):
                try:
                    response = model.generate_content(prompt_input)
                    recommended_games_from_gemini = response.text
                except Exception as e:
                    st.error(f"AI ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
                    st.warning("API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€, ë˜ëŠ” ìš”ì²­ ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ê±°ë‚˜ ë¶€ì ì ˆí•˜ì§€ ì•Šì€ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
            if recommended_games_from_gemini:
                st.subheader("ğŸ’¡ Gemini AIì˜ ì¶”ì²œ!")
                st.markdown(recommended_games_from_gemini) # API ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ í‘œì‹œ

elif recommendation_type == "ììœ ë¡œìš´ í…ìŠ¤íŠ¸ ì„¤ëª…":
    user_description = st.text_area(
        "ì–´ë–¤ ì¢…ë¥˜ì˜ ê²Œì„ì„ ì°¾ìœ¼ì‹œë‚˜ìš”? (ì˜ˆ: 'ìŠ¤í† ë¦¬ê°€ ê¹Šê³  íŒíƒ€ì§€ ì„¸ê³„ë¥¼ íƒí—˜í•˜ëŠ” RPG', 'ì¹œêµ¬ë“¤ê³¼ ê°™ì´ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ìºì£¼ì–¼í•œ íŒŒí‹° ê²Œì„')",
        height=100,
        key="gemini_rec_text_input"
    )
    if st.button("AI ì¶”ì²œë°›ê¸° (í…ìŠ¤íŠ¸ ì„¤ëª…)", key="btn_gemini_text_rec"):
        if user_description:
            st.info(f"'{user_description}' ì„¤ëª…ì— ë§ëŠ” ê²Œì„ì„ ì°¾ì•„ë³¼ê²Œìš”!")
            prompt_input = f"ë‹¤ìŒ ì„¤ëª…ì„ ë°”íƒ•ìœ¼ë¡œ ê²Œì„ 3ê°œë¥¼ ì¶”ì²œí•´ ì£¼ì„¸ìš”: '{user_description}'. ì¶”ì²œ ê²Œì„ì€ ê²Œì„ ì´ë¦„, ì¥ë¥´, 1~2ë¬¸ì¥ì˜ ê°„ëµí•œ ì„¤ëª… í˜•ì‹ìœ¼ë¡œ í•œêµ­ì–´ë¡œ ì œì‹œí•´ ì£¼ì„¸ìš”. ê·¸ë¦¬ê³  ì„¤ëª…ì€ í¥ë¯¸ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."
            with st.spinner("Gemini AIê°€ ê²Œì„ì„ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤..."):
                try:
                    response = model.generate_content(prompt_input)
                    recommended_games_from_gemini = response.text
                except Exception as e:
                    st.error(f"AI ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
                    st.warning("API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€, ë˜ëŠ” ìš”ì²­ ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ê±°ë‚˜ ë¶€ì ì ˆí•˜ì§€ ì•Šì€ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")
            if recommended_games_from_gemini:
                st.subheader("ğŸ’¡ Gemini AIì˜ ì¶”ì²œ!")
                st.markdown(recommended_games_from_gemini) # API ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ í‘œì‹œ
        else:
            st.warning("ê²Œì„ ìŠ¤íƒ€ì¼ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”!")

st.sidebar.markdown("---")
st.sidebar.info("Gemini AIë¥¼ í™œìš©í•œ ë” ìœ ì—°í•œ ê²Œì„ ì¶”ì²œì„ ê²½í—˜í•´ë³´ì„¸ìš”.")
